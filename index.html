<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Сравнение моделей голосовых эмбеддингов</title>
    
    <!-- Подключаем библиотеки -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.5/purify.min.js"></script>
    
    <!-- Подсветка синтаксиса -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- Поддержка дополнительных языков -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/java.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/cpp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>
    
    <!-- Для LaTeX формул -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <!-- Стили GitHub-like -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.2.0/github-markdown.min.css">
    <style>
        body {
            background-color: white;
            margin: 0;
            padding: 0;
        }
        
        .markdown-body {
            box-sizing: border-box;
            min-width: 200px;
            max-width: 980px;
            margin: 0 auto;
            padding: 45px;
            background-color: white;
        }
        
        /* Стили для каллоутов */
        .markdown-body blockquote {
            border-left: 4px solid #dfe2e5;
            padding: 10px 16px;
            margin: 16px 0;
            background: #f6f8fa;
        }
        
        .markdown-body blockquote.tip {
            border-left-color: #009400;
            background: #f8fff8;
        }
        
        .markdown-body blockquote.warning {
            border-left-color: #e6a700;
            background: #fffdf6;
        }
        
        .markdown-body blockquote.note {
            border-left-color: #0366d6;
            background: #f6f8fa;
        }
        
        .markdown-body blockquote.important {
            border-left-color: #cf222e;
            background: #fff8f8;
        }
        
        .markdown-body blockquote p {
            margin: 0;
        }
        
        /* Стили для блоков кода */
        .markdown-body pre {
            background: #f6f8fa;
            border-radius: 6px;
            padding: 16px;
            overflow: auto;
            border: 1px solid #e1e4e8;
        }
        
        .markdown-body code {
            background: rgba(175, 184, 193, 0.2);
            border-radius: 3px;
            padding: 0.1em 0.2em;
            font-size: 85%;
        }
        
        .markdown-body pre code {
            background: none;
            padding: 0;
            border-radius: 0;
        }
        
        /* Улучшаем скролл для длинных блоков кода */
        .markdown-body pre::-webkit-scrollbar {
            height: 8px;
        }
        
        .markdown-body pre::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 0 0 4px 4px;
        }
        
        .markdown-body pre::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        
        .markdown-body pre::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        @media (max-width: 767px) {
            .markdown-body {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <article class="markdown-body">
        <div id="content">Загрузка README...</div>
    </article>

    <script>
        // Функция для обработки каллоутов типа >[!TIP]
        function processCallouts(markdown) {
            // Обрабатываем многострочные каллоуты
            let lines = markdown.split('\n');
            let result = [];
            let inCallout = false;
            let currentCalloutType = '';
            
            for (let i = 0; i < lines.length; i++) {
                let line = lines[i];
                
                // Проверяем начало каллоута
                let calloutMatch = line.match(/^> \[!(\w+)\](.*)/);
                if (calloutMatch) {
                    if (!inCallout) {
                        // Начало нового каллоута
                        inCallout = true;
                        currentCalloutType = calloutMatch[1].toLowerCase();
                        result.push(`<blockquote class="${currentCalloutType}">`);
                        // Добавляем первую строку содержимого
                        if (calloutMatch[2].trim()) {
                            result.push(calloutMatch[2].trim());
                        }
                    }
                    continue;
                }
                
                // Проверяем продолжение каллоута (строки, начинающиеся с >)
                if (inCallout && line.startsWith('>')) {
                    let content = line.substring(1).trim();
                    if (content) {
                        // Если это пустая строка с >, добавляем перенос
                        if (content === '') {
                            result.push('<br>');
                        } else {
                            result.push(content);
                        }
                    }
                    continue;
                }
                
                // Если мы внутри каллоута и наткнулись на обычную строку
                if (inCallout && line.trim() !== '' && !line.startsWith('>')) {
                    // Завершаем каллоут
                    result.push('</blockquote>');
                    inCallout = false;
                    currentCalloutType = '';
                }
                
                // Добавляем обычную строку
                if (!inCallout) {
                    result.push(line);
                }
            }
            
            // Закрываем каллоут, если он остался открытым в конце файла
            if (inCallout) {
                result.push('</blockquote>');
            }
            
            return result.join('\n');
        }

        // Загружаем и рендерим README.md
        fetch('./README.md')
            .then(response => {
                if (!response.ok) throw new Error('README.md не найден');
                return response.text();
            })
            .then(markdown => {
                // Обрабатываем каллоуты
                markdown = processCallouts(markdown);
                
                // Рендерим Markdown
                const html = marked.parse(markdown, {
                    gfm: true,
                    breaks: true,
                    tables: true,
                    highlight: function(code, lang) {
                        // Если язык указан, используем Highlight.js
                        if (lang && hljs.getLanguage(lang)) {
                            try {
                                return hljs.highlight(code, { language: lang }).value;
                            } catch (err) {
                                console.warn(`Ошибка подсветки для языка ${lang}:`, err);
                            }
                        }
                        
                        // Если язык не указан, пытаемся автоопределить
                        try {
                            return hljs.highlightAuto(code).value;
                        } catch (err) {
                            console.warn('Ошибка автоопределения языка:', err);
                        }
                        
                        // Если ничего не получилось, возвращаем исходный код
                        return code;
                    }
                });
                
                // Безопасно вставляем в DOM
                document.getElementById('content').innerHTML = DOMPurify.sanitize(html);
                
                // Применяем подсветку ко всем блокам кода (на всякий случай)
                document.querySelectorAll('pre code').forEach((block) => {
                    hljs.highlightElement(block);
                });
                
                // Обновляем MathJax для рендера формул
                if (window.MathJax) {
                    MathJax.typeset();
                }
            })
            .catch(error => {
                document.getElementById('content').innerHTML = `
                    <h1>Ошибка</h1>
                    <p>Не удалось загрузить README.md: ${error.message}</p>
                    <p>Убедитесь, что файл README.md находится в корне репозитория.</p>
                `;
            });
    </script>
</body>
</html>
